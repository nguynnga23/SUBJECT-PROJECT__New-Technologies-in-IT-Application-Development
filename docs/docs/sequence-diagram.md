---
title: Sequence Diagram
---

## Nh√≥m 1: Qu·∫£n l√Ω t√†i kho·∫£n (UC001 - UC004)

```plantuml
@startuml
skinparam monochrome true

actor User
participant "Client" as Client
participant "Server" as Server
participant "Database" as DB

== UC001: ƒêƒÉng k√Ω t√†i kho·∫£n ==
User -> Client: Nh·∫≠p th√¥ng tin (email, s·ªë ƒëi·ªán tho·∫°i, m·∫≠t kh·∫©u)
Client -> Server: POST /register {email, phone, password}
Server -> DB: Ki·ªÉm tra email/s·ªë ƒëi·ªán tho·∫°i ƒë√£ t·ªìn t·∫°i ch∆∞a
DB --> Server: Tr·∫£ v·ªÅ k·∫øt qu·∫£
alt T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i
    Server --> Client: 400 "T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i"
    Client --> User: Hi·ªÉn th·ªã l·ªói
else T√†i kho·∫£n ch∆∞a t·ªìn t·∫°i
    Server -> Server: G·ª≠i OTP qua email/s·ªë ƒëi·ªán tho·∫°i
    Server --> Client: 200 "Y√™u c·∫ßu nh·∫≠p OTP"
    Client --> User: Hi·ªÉn th·ªã form OTP
    User -> Client: Nh·∫≠p OTP
    Client -> Server: POST /verify-otp {otp}
    Server -> DB: L∆∞u th√¥ng tin t√†i kho·∫£n
    DB --> Server: X√°c nh·∫≠n l∆∞u th√†nh c√¥ng
    Server -> Server: T·∫°o JWT token
    Server --> Client: 200 {token} "ƒêƒÉng k√Ω th√†nh c√¥ng"
    Client --> User: Th√¥ng b√°o th√†nh c√¥ng & l∆∞u token
end

== UC002: ƒêƒÉng nh·∫≠p h·ªá th·ªëng ==
User -> Client: Nh·∫≠p th√¥ng tin (email/phone, password)
Client -> Server: POST /login {email/phone, password}
Server -> DB: T√¨m t√†i kho·∫£n
DB --> Server: Tr·∫£ v·ªÅ t√†i kho·∫£n (ho·∫∑c null)
alt T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i ho·∫∑c m·∫≠t kh·∫©u sai
    Server --> Client: 401 "Th√¥ng tin ƒëƒÉng nh·∫≠p kh√¥ng ƒë√∫ng"
    Client --> User: Hi·ªÉn th·ªã l·ªói
else Th√¥ng tin ƒë√∫ng
    Server -> Server: T·∫°o JWT token
    Server --> Client: 200 {token}
    Client --> User: ƒêƒÉng nh·∫≠p th√†nh c√¥ng & l∆∞u token
end

== UC003: ƒêƒÉng xu·∫•t kh·ªèi h·ªá th·ªëng ==
User -> Client: Nh·∫•n n√∫t ƒëƒÉng xu·∫•t
Client -> Server: GET /logout (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
    Client --> User: Hi·ªÉn th·ªã l·ªói
else Token h·ª£p l·ªá
    Server -> DB: X√≥a token (n·∫øu d√πng blacklist)
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒêƒÉng xu·∫•t th√†nh c√¥ng"
    Client --> User: X√≥a token ·ªü client & quay l·∫°i m√†n h√¨nh ƒëƒÉng nh·∫≠p
end

== UC004: C·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n ==
User -> Client: Nh·∫≠p th√¥ng tin m·ªõi (avatar, bio, username, phone, password)
Client -> Server: PATCH /profile {data} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
    Client --> User: Hi·ªÉn th·ªã l·ªói & y√™u c·∫ßu ƒëƒÉng nh·∫≠p l·∫°i
else Token h·ª£p l·ªá
    Server -> DB: C·∫≠p nh·∫≠t th√¥ng tin
    DB --> Server: X√°c nh·∫≠n c·∫≠p nh·∫≠t
    Server --> Client: 200 "C·∫≠p nh·∫≠t th√†nh c√¥ng"
    Client --> User: Hi·ªÉn th·ªã th√¥ng tin m·ªõi
end

@enduml
```

## Nh√≥m 2: Qu·∫£n l√Ω k·∫øt b·∫°n (UC005 - UC011)

```plantuml
@startuml
skinparam monochrome true

actor User
participant "Client" as Client
participant "Server" as Server
participant "Database" as DB

== UC005: T√¨m ki·∫øm ng∆∞·ªùi d√πng ==
User -> Client: Nh·∫≠p t·ª´ kh√≥a (phone, email, username)
Client -> Server: GET /search?q={keyword} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
    Client --> User: Hi·ªÉn th·ªã l·ªói & y√™u c·∫ßu ƒëƒÉng nh·∫≠p l·∫°i
else Token h·ª£p l·ªá
    Server -> DB: T√¨m ki·∫øm ng∆∞·ªùi d√πng
    DB --> Server: Tr·∫£ v·ªÅ danh s√°ch k·∫øt qu·∫£
    Server --> Client: 200 {users}
    Client --> User: Hi·ªÉn th·ªã danh s√°ch ng∆∞·ªùi d√πng
end

== UC006: G·ª≠i l·ªùi m·ªùi k·∫øt b·∫°n ==
User -> Client: Ch·ªçn ng∆∞·ªùi d√πng v√† g·ª≠i l·ªùi m·ªùi
Client -> Server: POST /friend-request {targetId} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: L∆∞u y√™u c·∫ßu k·∫øt b·∫°n
    DB --> Server: X√°c nh·∫≠n l∆∞u
    Server --> Client: 200 "ƒê√£ g·ª≠i l·ªùi m·ªùi"
    Client --> User: Th√¥ng b√°o g·ª≠i th√†nh c√¥ng
end

== UC007: Ch·∫•p nh·∫≠n l·ªùi m·ªùi k·∫øt b·∫°n ==
User -> Client: Xem danh s√°ch l·ªùi m·ªùi & ch·ªçn "Ch·∫•p nh·∫≠n"
Client -> Server: POST /friend-request/accept {requestId} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh b·∫°n b√®
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ ch·∫•p nh·∫≠n"
    Client --> User: C·∫≠p nh·∫≠t danh s√°ch b·∫°n b√®
end

== UC008: T·ª´ ch·ªëi l·ªùi m·ªùi k·∫øt b·∫°n ==
User -> Client: Xem danh s√°ch l·ªùi m·ªùi & ch·ªçn "T·ª´ ch·ªëi"
Client -> Server: POST /friend-request/reject {requestId} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: X√≥a y√™u c·∫ßu k·∫øt b·∫°n
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ t·ª´ ch·ªëi"
    Client --> User: C·∫≠p nh·∫≠t danh s√°ch y√™u c·∫ßu
end

== UC009: Xem danh s√°ch b·∫°n b√® ==
User -> Client: Nh·∫•n "Xem danh s√°ch b·∫°n b√®"
Client -> Server: GET /friends (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: L·∫•y danh s√°ch b·∫°n b√®
    DB --> Server: Tr·∫£ v·ªÅ danh s√°ch
    Server --> Client: 200 {friends}
    Client --> User: Hi·ªÉn th·ªã danh s√°ch
end

== UC010: X√≥a b·∫°n b√® ==
User -> Client: Ch·ªçn b·∫°n b√® & nh·∫•n "X√≥a"
Client -> Server: DELETE /friends/{friendId} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: X√≥a quan h·ªá b·∫°n b√®
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ x√≥a b·∫°n b√®"
    Client --> User: C·∫≠p nh·∫≠t danh s√°ch
end

== UC011: Ch·∫∑n ng∆∞·ªùi d√πng ==
User -> Client: Ch·ªçn ng∆∞·ªùi d√πng & nh·∫•n "Ch·∫∑n"
Client -> Server: POST /block {userId} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: Th√™m v√†o danh s√°ch ch·∫∑n
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ ch·∫∑n"
    Client --> User: Th√¥ng b√°o ch·∫∑n th√†nh c√¥ng
end

@enduml
```

## Nh√≥m 3: Tin nh·∫Øn c√° nh√¢n v√† nh√≥m (UC012 - UC020)

```plantuml
@startuml
skinparam monochrome true

actor User
participant "Client" as Client
participant "Server" as Server
participant "Database" as DB

== UC012: G·ª≠i tin nh·∫Øn 1-1 ==
User -> Client: Nh·∫≠p tin nh·∫Øn & g·ª≠i
Client -> Server: POST /messages {toId, content} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: L∆∞u tin nh·∫Øn
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ g·ª≠i"
    Client --> User: Hi·ªÉn th·ªã tin nh·∫Øn trong cu·ªôc tr√≤ chuy·ªán
end

== UC013: T·∫°o nh√≥m chat ==
User -> Client: Nh·∫≠p t√™n nh√≥m & ch·ªçn th√†nh vi√™n
Client -> Server: POST /groups {name, members} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: T·∫°o nh√≥m & th√™m th√†nh vi√™n
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 {groupId}
    Client --> User: Hi·ªÉn th·ªã nh√≥m m·ªõi
end

== UC014: Th√™m th√†nh vi√™n v√†o nh√≥m chat ==
User -> Client: Ch·ªçn th√†nh vi√™n m·ªõi & th√™m
Client -> Server: POST /groups/{groupId}/members {userId} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: C·∫≠p nh·∫≠t danh s√°ch th√†nh vi√™n
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ th√™m"
    Client --> User: C·∫≠p nh·∫≠t danh s√°ch th√†nh vi√™n
end

== UC015: G·ª≠i ph·∫£n ·ª©ng tin nh·∫Øn ==
User -> Client: Ch·ªçn reaction (üëç, ‚ù§Ô∏è, ...)
Client -> Server: POST /messages/{messageId}/reactions {reaction} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: L∆∞u reaction
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ th√™m reaction"
    Client --> User: Hi·ªÉn th·ªã reaction
end

== UC016: Ghim tin nh·∫Øn ==
User -> Client: Ch·ªçn tin nh·∫Øn & nh·∫•n "Ghim"
Client -> Server: POST /messages/{messageId}/pin (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: ƒê√°nh d·∫•u tin nh·∫Øn l√† ghim
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ ghim"
    Client --> User: Hi·ªÉn th·ªã tin nh·∫Øn ghim
end

== UC017: G·ª≠i tin nh·∫Øn nh√≥m ==
User -> Client: Nh·∫≠p tin nh·∫Øn & g·ª≠i v√†o nh√≥m
Client -> Server: POST /groups/{groupId}/messages {content} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: L∆∞u tin nh·∫Øn
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ g·ª≠i"
    Client --> User: Hi·ªÉn th·ªã tin nh·∫Øn trong nh√≥m
end

== UC018: T·∫Øt th√¥ng b√°o nh√≥m chat ==
User -> Client: Ch·ªçn nh√≥m & t·∫Øt th√¥ng b√°o
Client -> Server: PATCH /groups/{groupId}/mute (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: C·∫≠p nh·∫≠t tr·∫°ng th√°i th√¥ng b√°o
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ t·∫Øt th√¥ng b√°o"
    Client --> User: X√°c nh·∫≠n t·∫Øt
end

== UC019: ƒê·ªïi vai tr√≤ trong nh√≥m ==
User -> Client: Ch·ªçn th√†nh vi√™n & g√°n vai tr√≤ leader
Client -> Server: PATCH /groups/{groupId}/roles {userId, role} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: C·∫≠p nh·∫≠t vai tr√≤
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ ƒë·ªïi vai tr√≤"
    Client --> User: C·∫≠p nh·∫≠t th√¥ng tin nh√≥m
end

== UC020: R·ªùi nh√≥m chat ==
User -> Client: Nh·∫•n "R·ªùi nh√≥m"
Client -> Server: DELETE /groups/{groupId}/members/me (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: X√≥a th√†nh vi√™n kh·ªèi nh√≥m
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ r·ªùi nh√≥m"
    Client --> User: Quay l·∫°i danh s√°ch nh√≥m
end

@enduml
```

## Nh√≥m 4: T√≠nh nƒÉng tin nh·∫Øn n√¢ng cao (UC021 - UC024)

```plantuml
@startuml
skinparam monochrome true

actor User
participant "Client" as Client
participant "Server" as Server
participant "Database" as DB
participant "Notification" as Notif

== UC021: G·ª≠i h√¨nh ·∫£nh, video, file ƒë√≠nh k√®m ==
User -> Client: Ch·ªçn file & g·ª≠i
Client -> Server: POST /messages/files {file} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: L∆∞u file & li√™n k·∫øt v·ªõi tin nh·∫Øn
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 {fileUrl}
    Client --> User: Hi·ªÉn th·ªã file trong cu·ªôc tr√≤ chuy·ªán
end

== UC022: G·ª≠i emoji, reactions ==
User -> Client: Ch·ªçn emoji & th·∫£ v√†o tin nh·∫Øn
Client -> Server: POST /messages/{messageId}/emoji {emoji} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: L∆∞u emoji
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ th√™m emoji"
    Client --> User: Hi·ªÉn th·ªã emoji
end

== UC023: Nh·∫≠n th√¥ng b√°o tin nh·∫Øn m·ªõi ==
Server -> DB: L∆∞u tin nh·∫Øn m·ªõi
DB --> Server: X√°c nh·∫≠n
Server -> Server: X√°c th·ª±c quy·ªÅn nh·∫≠n th√¥ng b√°o (d·ª±a tr√™n token c·ªßa ng∆∞·ªùi nh·∫≠n)
Server -> Notif: G·ª≠i th√¥ng b√°o ƒë·∫©y
Notif --> Client: Tin nh·∫Øn m·ªõi {content}
Client --> User: Hi·ªÉn th·ªã th√¥ng b√°o

== UC024: X√≥a tin nh·∫Øn ho·∫∑c cu·ªôc tr√≤ chuy·ªán ==
User -> Client: Ch·ªçn tin nh·∫Øn/cu·ªôc tr√≤ chuy·ªán & nh·∫•n "X√≥a"
Client -> Server: DELETE /messages/{messageId} ho·∫∑c /conversations/{conversationId} (Authorization: Bearer <token>)
Server -> Server: X√°c th·ª±c JWT token
alt Token kh√¥ng h·ª£p l·ªá
    Server --> Client: 401 "Token kh√¥ng h·ª£p l·ªá"
else Token h·ª£p l·ªá
    Server -> DB: X√≥a tin nh·∫Øn/cu·ªôc tr√≤ chuy·ªán
    DB --> Server: X√°c nh·∫≠n
    Server --> Client: 200 "ƒê√£ x√≥a"
    Client --> User: C·∫≠p nh·∫≠t giao di·ªán
end

@enduml
```
